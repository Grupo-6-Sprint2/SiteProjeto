<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap"
    rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap"
    rel="stylesheet" />
  <title>dashboards</title>
  <link rel="stylesheet" href="css/dashboardStyle.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="validarSessao(), listarFuncionarios()">

  <main>

    <!-- COISINHA DO LADO -->
    <div class="esquerda">
      <div class="lista">
        <span>ESTOQUES</span>

        <div class="estoque"><a href="gráficos.html">Estoque Norte</a></div>
        <div class="estoque"><a href="gráficos.html">Estoque Leste</a></div>
        <div class="estoque"><a href="gráficos.html">Estoque Sul</a></div>
        <div class="estoque"><a href="gráficos.html">Estoque Oeste</a></div>
      </div>
    </div>
    <!-- FIM DA COISINHA DO LADO -->


    <!-- VISÃO GERAL -->
    <div class="geral">

      <!-- nome + barra de pesquisa -->

      <div class="BemVindo">
        <div>
          <span>Bem vindo(a), <span id="nome_do_usuario"></span></span>
        </div>

        <div style="display: flex; justify-content: space-evenly;width: 650px; align-items: center;">
          <input id="input_pesquisa" placeholder="Pesquisar">
          <a href="cadastro-funcionario.html" class="buttonCadastrar">Cadastrar funcionário</a>
          <span id="nomeUsuario_denovo"></span>
          <div id="profile" onclick="viewExit()">
            <div class="foto"></div>
          </div>
        </div>
      </div>

      <div class="dashboards">

        <!-- cards -->
        <div class="graphics"> <!-- container com tudo debaixo da barra de cima -->



          <div class="status"> <!-- div utilizada para manter os cards e o gráfico de barras na mesma coluna -->

            <div class="container"> <!-- container contendo os cards -->


              <!-- card1 -->
              <div class="card">
                <div style="margin: 5px;">
                  <span>Número de sensores</span>
                  <div style="display: flex; margin-top: 10px;">
                    <div class="barra azul"></div>
                    <b>2532</b>
                  </div>
                </div>
              </div>

              <!-- card2 -->
              <div class="card">
                <div style="margin: 5px;">
                  <span>Quantidade de geladeiras</span>
                  <div style="display: flex; margin-top: 10px;">
                    <div class="barra amarelo"></div>
                    <b>3647</b>
                  </div>
                </div>
              </div>

              <!-- card3 -->
              <div class="card">
                <div style="margin: 5px;">
                  <span>Status</span>
                  <div style="display: flex; margin-top: 10px;">
                    <div class="barra verde"></div>
                    <b>Tudo ok!</b>
                  </div>
                </div>
              </div>
            </div>


            <!-- gráfico -->
            <div class="grafico">
              <span>QUANTIDADE LITROS DE SANGUE PERDIDOS</span>
              <canvas id="myChart"></canvas>
            </div>
          </div>

          <div class="rolha"> <!--div para o gráfico de rolhas + dados adicionais-->

            <div style="display: flex; flex-direction: column; align-items: center;">
              <div class="perdidos">
                <span>LITROS DE SANGUE PERDIDOS NO MÊS</span>
              </div>


              <!-- grafico de rolha -->
              <div class="graficoRolha">
                <canvas id="myChart2"></canvas>
              </div>

            </div>

            <div class="informações">
              <span>Total de litros armazenado: <br>
                Total de litros Perdidos:
              </span>

              <span>1500L<br>
                150
                L</span>
            </div>


          </div>




        </div> <!--fim da div "dashboards" -->
        <div class="">
          <canva id="moneyChart"></canva>
        </div>


        <!-- FIM DA VISÃO GERAL -->
        <div class="container">
          <div id="funcionarioCadastrado"
            style="background-color: white; width: 1000px; height: 200px; justify-content: center; margin-left: 150px; text-align: center; margin-top: 50px; border-radius: 10px;">
            <p>Funionarios cadastrados</p>

            <div id="funcionarios">


              <!-- aqui é um template dos funcionários, os de verdade são inseridos através de um select no banco, que insere funcoinario por funcionario-->

              <!-- 
                
              <div>
                  <span id="nomeFuncionario">nome do funcionaro: jorge</span>
                  <span id="emailFuncionario">email: @gmail.com</span>
                  <span id="telefoneFuncionario">número: 120985</span>
              </div>

              -->

            </div>
          </div>

        </div>
      </div>
</body>

</html>

<script>
  const ctx = document.getElementById('myChart');
  var viewDivExit = false;

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
      datasets: [{
        label: '2022',
        borderColor: 'rgba(255, 99, 131, 1)',
        backgroundColor: 'rgba(255, 99, 131, 1)',
        data: [870, 290, 100, 450, 220, 590, 90, 420, 900, 20, 130, 521],
        borderWidth: 2,
      },
      {
        label: '2023',
        borderColor: 'rgba(145, 145, 255, 1)',
        backgroundColor: 'rgba(145, 145, 255, 1)',
        data: [10, 100, 80, 50, 320, 100, 40, 220, 100, 0],
        borderWidth: 2
      },

      ]

    },
    options: {
      scales: {
        y: {
          max: 1000,
          beginAtZero: true
        }
      }
    }
  });

  const ctx2 = document.getElementById('myChart2');

  new Chart(ctx2, {
    type: 'doughnut',
    data: {
      labels: ['Total', 'Perdidos'],
      datasets: [{
        label: 'litros de sangue',
        backgroundColor: [
          'rgba(67, 209, 67, 1)',
          'rgba(255, 99, 131, 1)'
        ],
        data: [1500, 150],
        borderWidth: 0,
      },
      ]

    },
    hoverOffset: 4
  });

  const moneyCtx = document.getElementById('moneyChart');

  new Chart(moneyCtx, {
    type: 'line',
    data: {
      labels: ['Total'],
      datasets: [{
        label: 'litros de sangue',
        backgroundColor: [
          'rgba(67, 209, 67, 1)',
          'rgba(255, 99, 131, 1)'
        ],
        data: [1500, 150],
        borderWidth: 0,
      },
      ]

    },
    hoverOffset: 4
  });

  function viewExit() {
    viewDivExit = !viewDivExit
    if (viewDivExit) {
      profile.innerHTML = '<div class="foto"></div>'
    } else {
      profile.innerHTML = '<div class="foto"></div><div class="exit"><a href="page_login.html">Sair</a></div>'
    }

  }


  function validarSessao() {

    var gestor = sessionStorage.GESTOR
    var usuario = sessionStorage.NOME_USUARIO

    if (gestor == "null") {
      nome_do_usuario.innerHTML = usuario
      nomeUsuario_denovo.innerHTML = usuario
    }
    else {
      nome_do_usuario.innerHTML = 'você não tem nome ?'
    }
  }

  function listarFuncionarios() {
      var gestor = sessionStorage.ID_USUARIO;

      fetch(`/usuarios/listar/${gestor}`,  { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {

                    console.log('pericias encontradas:' + resposta.length)
    
                  plotarFuncionarios(resposta)

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
  }

  function plotarFuncionarios(resposta) {


    for (i = 0; i < resposta.length; i ++) {

      funcionarios.innerHTML += `
            <div>
              <span id="nomeFuncionario">nome do funcionaro: ${resposta[i].nomeNick}</span> 
              <span id="emailFuncionario">email: ${resposta[i].email}</span>
              <span id="telefoneFuncionario">número: ${resposta[i].telefone}</span>
            </div>
            `;

    }



  }

</script>