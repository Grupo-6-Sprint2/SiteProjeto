<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap"
      rel="stylesheet"
    />
    <title>Gráficos</title>
    <link rel="stylesheet" href="./css/dashboardStyle.css" />
    <link rel="stylesheet" href="./css/graficos.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- ------------------------------------------------------------------ HEADER --------------------------------------------------------------- -->
    <div class="header">
      <div class="logo">
        <a href="dashboardIndex.html"><h1>SaveBlood</h1></a>
      </div>
    </div>
    <!-- ------------------------------------------------------------- FIM DA HEADER ---------------------------------------------------- ------- -->

    <div class="tudo">
      <!-- tudo ksksk -->
      <!-- ------------------------------------------------------   div da esquerda ----------------------------------------------------------- -->

      <div class="navegacao_lateral">
        
        <div class="navegacao_lateral_dropdown">  
  
            <label>
                <img src="assets/geladeira-removebg-preview.png">
                <a href="gráficosDinamico.html">Estoque</a>
            </label> 
  
            <label>
                <img src="assets/alerta-removebg-preview.png">
                <a href="#">Registros</a>
            </label>
  
        </div>
        
      </div>

      <!-- ------------------------------------------------------ fim div da esquerda ---------------------------------------------------------- -->

      <!-- ------------------------------------------------------------- sensores ---------------------------------------------------------------- -->

      <div class="espaço_sensores" id="espaco_sensores">
        <!-- sensor 1 -->
        <!-- <div id="sensorDiv1" class="container_sensor">
          <div class="metadeCima" style="margin-top: -20xp">
            <div class="sensor">
              <img src="images/lm35.png" width="100%" />
            </div>

            <div class="dadosSensores">
              <a href="sensor.html">
                <span class="identificação corAlt"> Sensor #1012</span>
              </a>
              <span class="geladeira corAlt2"> Geladeira: 012</span>
              <div class="status">
                <span>status:</span> <span id="joinha">&#128077;</span>
              </div>
            </div>
          </div>

          <div class="metadeBaixo">
            <div class="grafico_linha" style="height: 100%; width: 70%">
              <canvas id="myChart1"></canvas>
            </div>

            <p class="container_sensor_input" id="temperaturaValor1"></p>
          </div>
        </div> -->

        <a href="sensor.html" class="sensorContainer" id="sensorDiv1">
          <div class="dadosSensores">
            <div>
              <span class="identificação corAlt"> Sensor #1012</span>
            </div>
            <span class="geladeira corAlt2"> Geladeira: 012</span>
            <div class="status">
              <span>status:</span> <span id="joinha">&#128077;</span>
            </div>
            <span
              class="valorTemperatura"
              style="font-size: 30px"
              id="temperaturaValor1"
            ></span>
          </div>
          <div class="graficoContainer">
            <canvas id="myChart1"></canvas>
          </div>
        </a>

        <div class="sensorContainer" id="sensorDiv2">
          <div class="dadosSensores">
            <a href="sensor.html">
              <span class="identificação corAlt"> Sensor #1012</span>
            </a>
            <span class="geladeira corAlt2"> Geladeira: 012</span>
            <div class="status">
              <span>status:</span> <span id="joinha">&#128077;</span>
            </div>
            <span style="font-size: 30px" id="temperaturaValor2"></span>
          </div>
          <div class="graficoContainer">
            <canvas id="myChart2"></canvas>
          </div>
        </div>

        <div class="sensorContainer" id="sensorDiv3">
          <div class="dadosSensores">
            <a href="sensor.html">
              <span class="identificação corAlt"> Sensor #1012</span>
            </a>
            <span class="geladeira corAlt2"> Geladeira: 012</span>
            <div class="status">
              <span>status:</span> <span id="joinha">&#128077;</span>
            </div>
            <span style="font-size: 30px" id="temperaturaValor3"></span>
          </div>
          <div class="graficoContainer">
            <canvas id="myChart3"></canvas>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  const ctx = document.getElementById("myChart1");
  var grafico1 = new Chart(ctx, {
    type: "line",
    data: {
      datasets: [
        {
          label: "temp",
          borderColor: "rgba(255, 99, 131, 1)",
          backgroundColor: "rgba(255, 99, 131, 1)",
          borderWidth: 2,
        },
      ],
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });

  const ctx2 = document.getElementById("myChart2");
  var grafico2 = new Chart(ctx2, {
    type: "line",
    data: {
      datasets: [
        {
          label: "temp",
          borderColor: "rgba(255, 99, 131, 1)",
          backgroundColor: "rgba(255, 99, 131, 1)",
          borderWidth: 2,
        },
      ],
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });

  const ctx3 = document.getElementById("myChart3");
  var grafico3 = new Chart(ctx3, {
    type: "line",
    data: {
      datasets: [
        {
          label: "temp",
          borderColor: "rgba(255, 99, 131, 1)",
          backgroundColor: "rgba(255, 99, 131, 1)",
          borderWidth: 2,
        },
      ],
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });

  var listaGraficos = [grafico1, grafico2, grafico3];
  setInterval(() => {
    fetch("http://localhost:3300/sensores/lm35/temperatura", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    }).then((response) => {
      response.json().then((json) => {
        // console.log(json);
        var randomNumber = 0;
        randomNumber = json;

        var listaSensores = [];
        listaSensores.push(randomNumber);
        listaSensores.push(randomNumber - 1);
        listaSensores.push(randomNumber * 2);
        console.log(listaSensores);

        for (
          var incremento = 0;
          incremento < listaSensores.length;
          incremento++
        ) {
          var text = document.getElementById(
            `temperaturaValor${incremento + 1}`
          );

          text.innerHTML = `${listaSensores[incremento].toFixed(1)}ºC`;

          var element = document.getElementById(`sensorDiv${incremento + 1}`);

          if (listaSensores[incremento] < 1 || listaSensores[incremento] > 6) {
            element.style.border = "3px solid red";
          } else if (
            listaSensores[incremento] < 2 ||
            listaSensores[incremento] > 4
          ) {
            element.style.border = "3px solid yellow";
          } else {
            element.style.border = "none";
          }
          atualizarGrafico(
            listaGraficos[incremento],
            listaSensores[incremento]
          );
        }
      });
    });
  }, 1000);

  function atualizarGrafico(grafico, dado) {
    if (grafico.data.datasets[0].data.length == 10) {
      grafico.data.datasets[0].data.shift();
      grafico.data.labels.shift();
    }
    grafico.data.datasets[0].data.push(dado);
    grafico.data.labels.push(dado);
    grafico.update();
  }
</script>

<!-- <script>
  function funcao() {
    var sensor = document.querySelector(".container_sensor");
    var temp = document.getElementById("temperaturaValor");
    var cor = document.querySelector(".corAlt");
    var cor2 = document.querySelector(".corAlt2");
    var corInput = document.querySelector(".container_sensor_input");
    var status = document.querySelector(".status");
    var joia = document.getElementById("joinha");

    if (temp.value >= 6 || temp.value <= 2) {
      sensor.style.backgroundColor = "#ff0022";
      sensor.style.borderColor = "#3b1111";
      cor.style.backgroundColor = "#3b1111";
      cor2.style.backgroundColor = "#3b1111";
      corInput.style.backgroundColor = "#ff0022";
      status.style.backgroundColor = "#ff0022";
      status.style.color = "#3b1111";
      joia.innerHTML = "&#9888;";
    } else if (temp.value >= 5.5 || temp.value <= 2.5) {
      sensor.style.backgroundColor = "#ffc342";
      sensor.style.borderColor = "#ee8742";
      cor.style.backgroundColor = "#86523b";
      cor2.style.backgroundColor = "#86523b";
      corInput.style.backgroundColor = "#ffc342";
      status.style.backgroundColor = "#ffc342";
      joia.innerHTML = "&#10071;";
    } else {
      sensor.style.backgroundColor = "rgb(189, 201, 212);";
    }
  }
</script> -->
